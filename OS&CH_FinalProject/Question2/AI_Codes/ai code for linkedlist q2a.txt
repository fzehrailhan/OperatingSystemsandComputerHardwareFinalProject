#include <stdio.h>

#define DISK_SIZE 16

typedef struct {
    int used;
    int next;
} Block;

Block disk[DISK_SIZE];

// Allocate blocks (not necessarily consecutive)
int linked_allocate(int size) {
    int first = -1;
    int prev = -1;

    for (int i = 0; i < DISK_SIZE && size > 0; i++) {
        if (disk[i].used == 0) {
            disk[i].used = 1;
            disk[i].next = -1;

            if (first == -1)
                first = i;

            if (prev != -1)
                disk[prev].next = i;

            prev = i;
            size--;
        }
    }

    if (size > 0)
        return -1;

    return first;
}

// Free linked blocks
void linked_free(int start) {
    int current = start;

    while (current != -1) {
        int next = disk[current].next;
        disk[current].used = 0;
        disk[current].next = -1;
        current = next;
    }
}

// Print disk state
void print_disk() {
    for (int i = 0; i < DISK_SIZE; i++) {
        printf("%d ", disk[i].used);
    }
    printf("\n");
}

int main() {
    int start = linked_allocate(4);
    print_disk();

    linked_free(start);
    print_disk();

    return 0;
}
